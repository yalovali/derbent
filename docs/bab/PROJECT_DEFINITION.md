# BAB Project Definition

**Version**: 2.0  
**Date**: 2026-01-29  
**Status**: ACTIVE - Updated for Calimero Integration  
**Profile**: `@Profile("bab")`  
**Related Project**: [Calimero CAN Gateway](../../../../calimero) - C++ backend service

---

## Executive Summary

**BAB (Building Automation Bus)** is a comprehensive **IoT Gateway Management System** that provides web-based administration for the **Calimero CAN Gateway**. BAB serves as the **Java/Vaadin frontend** for managing, monitoring, and configuring the **Calimero C++ backend service** which handles real-time CAN bus communication, data logging, and protocol routing.

## Project Scope & Architecture

### Dual-Component Architecture
```
┌─────────────────────────────────────────────────────────────┐
│                   BAB IoT Gateway System                   │
├─────────────────────────────────────────────────────────────┤
│  BAB Frontend (Java/Vaadin)    │  Calimero Backend (C++)   │
│  • Web UI Management           │  • Real-time CAN Gateway │
│  • Configuration Management    │  • Multi-protocol I/O    │
│  • User Authentication         │  • Event-driven Pipeline │
│  • Device Monitoring           │  • High-performance       │
│  • Project Organization        │  • Data Logging          │
├─────────────────────────────────────────────────────────────┤
│  Integration: HTTP API + Process Management + File Config  │
└─────────────────────────────────────────────────────────────┘
```

### Primary Purpose
- **Calimero Management Interface**: Web-based administration for Calimero CAN gateway service
- **Multi-Protocol Gateway Management**: CAN-bus, Serial (UART/RS232), Ethernet (UDP/TCP), ROS2 integration
- **Real-time Monitoring**: Live dashboard for 50k+ fps data throughput, <10ms latency operations
- **Production Operations**: Device configuration, data logging management, system health monitoring
- **Industrial IoT Focus**: Building automation, vehicle telematics, industrial monitoring, test benches

### Target Environment
- **Deployment**: Industrial IoT gateways, embedded Linux systems, test laboratories
- **Backend Service**: Calimero C++ service (located at `~/git/calimero`) 
- **Resource Constraints**: Optimized for embedded systems, industrial controllers
- **Networks**: Industrial CAN networks, Ethernet/IP, Modbus, ROS2 ecosystems
- **Use Cases**: Automotive testing, building automation, industrial data acquisition

## Architecture Overview

### BAB-Calimero Integration Model

**BAB Responsibilities (Java/Vaadin Frontend)**:
1. **Device Management**: Gateway device registration, configuration, lifecycle
2. **Node Configuration**: CAN/Serial/Ethernet interface setup and management
3. **User Management**: Authentication, authorization, multi-company isolation
4. **Project Organization**: BAB-specific projects with IP configuration and device grouping
5. **System Monitoring**: Dashboard for Calimero service health, performance metrics
6. **Configuration Generation**: Generate Calimero JSON config files from BAB entity settings
7. **Process Management**: Start/stop/restart Calimero service instances
8. **Log Management**: Access and manage Calimero data logs, replay configurations

**Calimero Responsibilities (C++ Backend Service)**:
1. **Real-time I/O**: CAN, Serial, Ethernet, File replay at 50k+ fps
2. **Protocol Routing**: Port-to-port forwarding, CAN ID filtering, protocol bridging  
3. **Data Logging**: High-performance CSV/binary logging with rotation
4. **Event Processing**: Event-driven pipeline with bounded queues, drop-on-full policy
5. **HTTP API**: RESTful management endpoints for BAB integration
6. **Performance**: <10ms latency, <1% idle CPU, production-grade reliability

### Core Components

#### BAB Entities (Frontend Management)
| Entity | Purpose | Calimero Integration |
|--------|---------|---------------------|
| `CBabDevice` | Gateway device representation | Maps to Calimero instance + HTTP API endpoint |
| `CBabNodeCAN` | CAN interface configuration | Generates `can.json` config for Calimero |
| `CBabNodeSerial` | Serial interface configuration | Generates `serial.json` config for Calimero |
| `CBabNodeEthernet` | Ethernet interface configuration | Generates `ethernet.json` config for Calimero |
| `CBabNodeROS` | ROS2 interface configuration | Generates `ros.json` config for Calimero |
| `CProject_Bab` | BAB project with network config | Project-level Calimero deployment settings |
| `CSystemSettings_Bab` | Gateway system preferences | Global Calimero service configuration |

#### Calimero Integration (Backend Service)
| Component | Technology | Purpose |
|-----------|------------|---------|
| **Calimero Service** | C++17 | High-performance CAN gateway and data logger |
| **HTTP API** | REST (port 8077) | Management interface for BAB integration |
| **Configuration Files** | JSON | Generated by BAB, consumed by Calimero |
| **Data Logs** | CSV/Binary | Generated by Calimero, viewed through BAB |
| **Process Management** | systemd/Docker | Managed by BAB system administration |

### Key Relationships
```
CCompany (1) ←→ (1) CBabDevice ←→ (1) Calimero Instance
CBabDevice (1) ←→ (*) CBabNode* ←→ JSON Config Files
CProject_Bab (*) ←→ (1) CBabDevice ←→ Calimero Deployment
BAB HTTP API ←→ Calimero HTTP API (port 8077)
```

## Business Requirements

### Functional Requirements

#### 1. Calimero Lifecycle Management
- **Service Control**: Start/stop/restart Calimero instances through BAB web interface
- **Health Monitoring**: Real-time status monitoring via Calimero HTTP API integration
- **Configuration Management**: Generate and deploy Calimero JSON configurations from BAB entities
- **Log Access**: Browse, download, and replay Calimero data logs through BAB interface

#### 2. Multi-Protocol Node Management  
- **CAN Interfaces**: Configure bitrate (125k-1M), extended frames, filtering rules
- **Serial Ports**: UART/RS232/RS485 configuration, baud rate, parity, flow control
- **Ethernet Interfaces**: UDP/TCP endpoints, IP configuration, routing rules  
- **ROS2 Integration**: Topic mapping, QoS profiles, namespace configuration
- **Routing Engine**: Port-to-port forwarding rules, CAN ID filtering, protocol bridging

#### 3. Real-time Operations Dashboard
- **Live Metrics**: Frame rates (per port), queue depths, latency measurements
- **Performance Monitoring**: CPU usage, memory consumption, drop rates
- **System Health**: Node status, connection states, error conditions
- **Throughput Visualization**: Real-time graphs for 50k+ fps data streams

### Non-Functional Requirements

#### 1. Performance (BAB Frontend)
- **Lightweight UI**: Minimal memory footprint for embedded deployment
- **Responsive Interface**: <2 second page load times
- **Real-time Updates**: Live dashboard updates every 1-5 seconds

#### 2. Integration Performance (Calimero Backend)
- **High Throughput**: 50,000+ frames/second sustained
- **Low Latency**: <10ms end-to-end (CAN → log)
- **Minimal Overhead**: <1% idle CPU usage
- **Reliability**: 99.9% uptime for gateway operations

#### 3. System Requirements
- **Platform**: Linux (Ubuntu 20.04+, embedded distributions)
- **Memory**: BAB: <256MB, Calimero: <128MB 
- **Storage**: 1GB system, 10GB+ for data logs
- **Network**: Industrial Ethernet, CAN interfaces

## Technical Architecture

### Integration Patterns

#### 1. Configuration Generation Pipeline
```
BAB Entity Changes → JSON Generation → Calimero Config Update → Service Reload
     ↓                    ↓                    ↓                    ↓
  Entity Validation  →  File Writing  →   HTTP API Call   →   Live Reload
```

#### 2. Monitoring Integration
```
Calimero Metrics → HTTP API (port 8077) → BAB Polling → Dashboard Updates
     ↓                     ↓                    ↓            ↓
  Performance Data  →  JSON Response  →  Entity Updates → UI Refresh
```

#### 3. Process Management
```
BAB Command → Process Control → Calimero Service → Status Update → BAB UI
     ↓             ↓                ↓                  ↓           ↓
 Start/Stop → systemd/Docker → Service State → HTTP Response → Dashboard
```

### Calimero Project Reference

**Location**: `~/git/calimero`  
**Type**: C++17 project with comprehensive management documentation  
**Key Files**:
- **Architecture**: `docs/ARCHITECTURE.md`
- **Configuration**: `docs/CONFIGURATION.md` 
- **Management Docs**: `docs/management/` (8 documents, 272 story points)
- **HTTP API**: `src/http/webservice/handlers/`
- **Project Tracking**: `docs/management/calimero_project_management.xls`

**Integration Points**:
- **HTTP API**: `http://localhost:8077/api/request`
- **Config Directory**: `/etc/calimero/` or `./config/`
- **Log Directory**: `/var/log/calimero/` or `./records/`
- **Authentication**: Bearer token (`test_token_123` default)

## Project Phases & Scope

### Phase 1: Foundation (Current - BAB Core)
- ✅ **Basic Entity Model**: CBabDevice, CBabNode hierarchy
- ✅ **Spring Profile Isolation**: `@Profile("bab")` components
- ✅ **Web Interface**: Vaadin-based management UI
- ⏳ **Configuration Generation**: JSON config file generation from entities

### Phase 2: Calimero Integration
- **Service Management**: Start/stop/restart Calimero from BAB
- **Configuration Pipeline**: Generate Calimero configs from BAB entities
- **Health Monitoring**: Integrate with Calimero HTTP API
- **Log Access**: Browse and download Calimero data logs

### Phase 3: Advanced Operations
- **Real-time Dashboard**: Live performance metrics and visualizations
- **Routing Management**: Configure port-to-port forwarding rules
- **Log Replay**: Manage Calimero replay configurations
- **Alert System**: Monitoring and alerting for production deployment

### Phase 4: Production Hardening
- **Docker Integration**: Containerized deployment with Calimero
- **systemd Management**: Service lifecycle management
- **Backup/Restore**: Configuration and log management
- **Performance Optimization**: Embedded system deployment

## Constraints & Limitations

### Technical Constraints
- **Linux Dependency**: Calimero requires Linux for SocketCAN support
- **Resource Limits**: Optimized for embedded systems (512MB total memory)
- **Real-time Boundaries**: Best-effort latency, not safety-critical certified
- **Single Device Model**: One Calimero instance per company/gateway

### Integration Constraints  
- **HTTP API Dependency**: BAB depends on Calimero HTTP API availability
- **Configuration Coupling**: BAB entity changes require Calimero service reload
- **File System Access**: BAB needs read/write access to Calimero config/log directories
- **Process Permissions**: BAB may need elevated permissions for service management

## Success Criteria

### Phase 1 (BAB Foundation)
- [x] Entity model implementation complete
- [x] Web interface functional for device/node management
- [ ] JSON configuration generation working
- [ ] Integration with Calimero HTTP API established

### Phase 2 (Integration)
- [ ] Full Calimero lifecycle management (start/stop/restart)
- [ ] Real-time monitoring dashboard operational
- [ ] Configuration changes applied without manual intervention
- [ ] Log management interface functional

### Phase 3 (Production)
- [ ] 99.9% uptime for combined BAB+Calimero system
- [ ] <2 second response time for management operations
- [ ] Support for 50k+ fps operations monitoring
- [ ] Industrial deployment validation

## Risk Management

### Technical Risks
| Risk | Impact | Mitigation |
|------|--------|------------|
| Calimero API changes | High | Version pinning, API compatibility testing |
| Performance bottlenecks | Medium | Profiling, asynchronous operations |
| Configuration sync issues | High | Atomic updates, validation, rollback capability |
| Process management complexity | Medium | systemd integration, error handling |

### Operational Risks
| Risk | Impact | Mitigation |
|------|--------|------------|
| Service dependency failures | High | Health checks, automatic restart, fallback modes |
| Resource exhaustion | Medium | Monitoring, log rotation, resource limits |
| Network connectivity issues | Medium | Local caching, offline mode, reconnection logic |
| Security vulnerabilities | High | Authentication, authorization, API security |

---

## Related Documentation

### BAB Documentation
- **[Architecture Overview](ARCHITECTURE.md)**: Technical architecture and integration patterns
- **[Entity Model](ENTITY_MODEL.md)**: BAB entities and relationships  
- **[Development Guide](DEVELOPMENT_GUIDE.md)**: Development environment and standards
- **[Calimero Integration Plan](CALIMERO_INTEGRATION_PLAN.md)**: Detailed integration roadmap and implementation
- **[BAB-Calimero API Specification](CALIMERO_API_INTEGRATION.md)**: Technical API integration details

### Calimero Documentation (~/git/calimero/)
**Reference Location**: `/home/yasin/git/calimero/`

**Core Documentation**:
- **[Product Overview](../../../calimero/docs/management/01_product_overview.md)**: Calimero product vision and capabilities
- **[Technical Architecture](../../../calimero/docs/ARCHITECTURE.md)**: Calimero system design and event-driven pipeline
- **[Configuration Reference](../../../calimero/docs/CONFIGURATION.md)**: JSON configuration format and examples
- **[HTTP API Reference](../../../calimero/src/http/docs/API_REFERENCE.md)**: Complete REST API specification
- **[Project Management](../../../calimero/docs/management/)**: 8-document management suite (272 story points)

**Management Documentation Suite**:
1. **[01_product_overview.md](../../../calimero/docs/management/01_product_overview.md)**: Executive summary, target users, value proposition
2. **[02_current_state_analysis.md](../../../calimero/docs/management/02_current_state_analysis.md)**: Current implementation status
3. **[03_target_architecture.md](../../../calimero/docs/management/03_target_architecture.md)**: Technical architecture design
4. **[04_epics_and_features.md](../../../calimero/docs/management/04_epics_and_features.md)**: 8 epics, 42 features breakdown
5. **[05_user_stories.md](../../../calimero/docs/management/05_user_stories.md)**: 69 user stories, 272 story points total
6. **[06_execution_roadmap.md](../../../calimero/docs/management/06_execution_roadmap.md)**: 5-phase delivery plan, 26-30 weeks
7. **[07_open_questions_and_decisions.md](../../../calimero/docs/management/07_open_questions_and_decisions.md)**: Technical decisions and trade-offs
8. **[calimero_project_management.xls](../../../calimero/docs/management/calimero_project_management.xls)**: Detailed task breakdown and tracking

**Technical References**:
- **[HTTP Server Implementation](../../../calimero/src/http/)**: C++ HTTP server with REST handlers
- **[Configuration Examples](../../../calimero/config/)**: JSON config file templates
- **[Testing Framework](../../../calimero/tests/)**: Unit, component, and integration tests

## BAB Project Agile Implementation Plan

### Epic Breakdown (BAB-Specific)

#### Epic B1: Calimero Service Integration (8 weeks)
**Goal**: Establish BAB-Calimero communication and service lifecycle management

**Features**:
- **B1.1**: Calimero Process Management (start/stop/restart from BAB UI)
- **B1.2**: HTTP API Integration (BAB ↔ Calimero communication) 
- **B1.3**: Configuration Pipeline (BAB entities → Calimero JSON config)
- **B1.4**: Health Monitoring (real-time Calimero service status)

#### Epic B2: Node Configuration Management (6 weeks)
**Goal**: Complete UI for managing all Calimero transport protocols

**Features**:
- **B2.1**: CAN Node Management (bitrate, interface, extended frames)
- **B2.2**: Serial Node Management (UART/RS232 configuration)
- **B2.3**: Ethernet Node Management (UDP/TCP endpoints)
- **B2.4**: ROS2 Node Management (topics, QoS, namespaces)

#### Epic B3: Real-time Operations Dashboard (4 weeks)
**Goal**: Live monitoring and performance visualization

**Features**:
- **B3.1**: Performance Metrics Dashboard (50k+ fps monitoring)
- **B3.2**: Node Status Visualization (connection states, errors)
- **B3.3**: Data Flow Monitoring (routing rules, throughput graphs)
- **B3.4**: Alert System (threshold-based notifications)

#### Epic B4: Data Management Interface (4 weeks)
**Goal**: Log file management and replay configuration

**Features**:
- **B4.1**: Log File Browser (view, download, delete Calimero logs)
- **B4.2**: Replay Configuration (file replay setup and control)
- **B4.3**: Data Export Tools (CSV processing, format conversion)
- **B4.4**: Storage Management (log rotation, cleanup policies)

#### Epic B5: Production Operations (3 weeks)
**Goal**: Production deployment and maintenance tools

**Features**:
- **B5.1**: Backup/Restore (configuration and data backup)
- **B5.2**: System Diagnostics (health checks, connectivity tests)
- **B5.3**: Performance Tuning (resource monitoring, optimization)

### Total Delivery Timeline: **25 weeks (6 months)**
### Story Points: **180 points** (estimated)
### Team Velocity: **15 points/2-week sprint** (1-2 developers)

---

**Document Control**:
- **Version**: 2.0
- **Created**: 2026-01-29
- **Calimero Integration**: Added comprehensive backend service integration and agile roadmap
- **Calimero Reference**: Added complete project reference location and documentation links
- **Next Review**: 2026-04-29
- **Classification**: System Architecture Document